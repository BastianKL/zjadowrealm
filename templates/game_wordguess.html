{% extends "base.html" %}

{% block title %}Word Guess - ZjadowRealm{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="mb-3">
                <a href="{{ url_for('games') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Games
                </a>
            </div>

            <!-- Word Guess Game -->
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-spell-check me-2"></i>Word Guess
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="text-center">
                                <div class="word-display mb-4">
                                    <h2 id="wordDisplay" class="letter-spacing">_ _ _ _ _</h2>
                                    <p class="text-muted">Category: <span id="wordCategory">Animals</span></p>
                                </div>
                                
                                <div class="alphabet-grid mb-4">
                                    <!-- Letters will be generated by JavaScript -->
                                </div>
                                
                                <div class="hangman-display">
                                    <canvas id="hangmanCanvas" width="200" height="250"></canvas>
                                </div>
                                
                                <div class="mt-3">
                                    <h6>Guesses remaining: <span id="guessesLeft">6</span></h6>
                                    <h6>Score: <span id="wordScore">0</span></h6>
                                    <button class="btn btn-warning" onclick="startWordGuess()">New Word</button>
                                    <button class="btn btn-secondary" onclick="giveWordHint()">Hint</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.letter-spacing {
    letter-spacing: 0.5rem;
}

.alphabet-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
}

@media (max-width: 768px) {
    #hangmanCanvas {
        max-width: 100%;
        height: auto;
    }
}
</style>

<script>
// Word Guess game state
let wordGuessState = {
    words: {
        'Animals': ['ELEPHANT', 'GIRAFFE', 'PENGUIN', 'DOLPHIN', 'KANGAROO', 'BUTTERFLY'],
        'Countries': ['AUSTRALIA', 'BRAZIL', 'CANADA', 'DENMARK', 'EGYPT', 'FRANCE'],
        'Food': ['PIZZA', 'HAMBURGER', 'SPAGHETTI', 'CHOCOLATE', 'STRAWBERRY', 'SANDWICH']
    },
    currentWord: '',
    currentCategory: 'Animals',
    guessedLetters: [],
    wrongGuesses: 0,
    maxWrongGuesses: 6,
    score: 0,
    gameOver: false
};

// Load page
document.addEventListener('DOMContentLoaded', function() {
    initializeWordGuess();
});

function initializeWordGuess() {
    createAlphabetGrid();
    startWordGuess();
}

function createAlphabetGrid() {
    const container = document.querySelector('.alphabet-grid');
    if (!container) return;
    
    container.innerHTML = '';
    for (let i = 65; i <= 90; i++) {
        const letter = String.fromCharCode(i);
        const button = document.createElement('button');
        button.className = 'btn btn-outline-secondary btn-sm m-1';
        button.textContent = letter;
        button.onclick = () => guessLetter(letter);
        button.id = `letter-${letter}`;
        container.appendChild(button);
    }
}

function startWordGuess() {
    const categories = Object.keys(wordGuessState.words);
    wordGuessState.currentCategory = categories[Math.floor(Math.random() * categories.length)];
    const wordsInCategory = wordGuessState.words[wordGuessState.currentCategory];
    wordGuessState.currentWord = wordsInCategory[Math.floor(Math.random() * wordsInCategory.length)];
    wordGuessState.guessedLetters = [];
    wordGuessState.wrongGuesses = 0;
    wordGuessState.gameOver = false;
    
    // Reset alphabet buttons
    for (let i = 65; i <= 90; i++) {
        const letter = String.fromCharCode(i);
        const button = document.getElementById(`letter-${letter}`);
        if (button) {
            button.disabled = false;
            button.className = 'btn btn-outline-secondary btn-sm m-1';
        }
    }
    
    updateWordGuessDisplay();
    drawHangman();
}

function guessLetter(letter) {
    if (wordGuessState.gameOver || wordGuessState.guessedLetters.includes(letter)) return;
    
    wordGuessState.guessedLetters.push(letter);
    const button = document.getElementById(`letter-${letter}`);
    
    if (wordGuessState.currentWord.includes(letter)) {
        button.className = 'btn btn-success btn-sm m-1';
        wordGuessState.score += 10;
    } else {
        button.className = 'btn btn-danger btn-sm m-1';
        wordGuessState.wrongGuesses++;
        drawHangman();
    }
    
    button.disabled = true;
    
    // Check win/lose conditions
    const wordRevealed = wordGuessState.currentWord.split('').every(letter => 
        wordGuessState.guessedLetters.includes(letter));
    
    if (wordRevealed) {
        wordGuessState.gameOver = true;
        wordGuessState.score += 50;
        setTimeout(() => alert('You won! +50 bonus points'), 100);
    } else if (wordGuessState.wrongGuesses >= wordGuessState.maxWrongGuesses) {
        wordGuessState.gameOver = true;
        setTimeout(() => alert(`Game Over! The word was: ${wordGuessState.currentWord}`), 100);
    }
    
    updateWordGuessDisplay();
}

function updateWordGuessDisplay() {
    const displayWord = wordGuessState.currentWord.split('').map(letter => 
        wordGuessState.guessedLetters.includes(letter) ? letter : '_').join(' ');
    
    document.getElementById('wordDisplay').textContent = displayWord;
    document.getElementById('wordCategory').textContent = wordGuessState.currentCategory;
    document.getElementById('guessesLeft').textContent = 
        wordGuessState.maxWrongGuesses - wordGuessState.wrongGuesses;
    document.getElementById('wordScore').textContent = wordGuessState.score;
}

function drawHangman() {
    const canvas = document.getElementById('hangmanCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 3;
    
    // Draw based on wrong guesses
    if (wordGuessState.wrongGuesses >= 1) {
        // Base
        ctx.beginPath();
        ctx.moveTo(10, 240);
        ctx.lineTo(100, 240);
        ctx.stroke();
    }
    if (wordGuessState.wrongGuesses >= 2) {
        // Pole
        ctx.beginPath();
        ctx.moveTo(30, 240);
        ctx.lineTo(30, 20);
        ctx.stroke();
    }
    if (wordGuessState.wrongGuesses >= 3) {
        // Top beam
        ctx.beginPath();
        ctx.moveTo(30, 20);
        ctx.lineTo(120, 20);
        ctx.stroke();
    }
    if (wordGuessState.wrongGuesses >= 4) {
        // Noose
        ctx.beginPath();
        ctx.moveTo(120, 20);
        ctx.lineTo(120, 50);
        ctx.stroke();
    }
    if (wordGuessState.wrongGuesses >= 5) {
        // Head
        ctx.beginPath();
        ctx.arc(120, 70, 20, 0, Math.PI * 2);
        ctx.stroke();
    }
    if (wordGuessState.wrongGuesses >= 6) {
        // Body and limbs
        ctx.beginPath();
        ctx.moveTo(120, 90);
        ctx.lineTo(120, 180);
        ctx.moveTo(120, 120);
        ctx.lineTo(90, 140);
        ctx.moveTo(120, 120);
        ctx.lineTo(150, 140);
        ctx.moveTo(120, 180);
        ctx.lineTo(90, 210);
        ctx.moveTo(120, 180);
        ctx.lineTo(150, 210);
        ctx.stroke();
    }
}

function giveWordHint() {
    if (wordGuessState.gameOver) return;
    
    const unguessedLetters = wordGuessState.currentWord.split('')
        .filter(letter => !wordGuessState.guessedLetters.includes(letter));
    
    if (unguessedLetters.length > 0) {
        const hintLetter = unguessedLetters[Math.floor(Math.random() * unguessedLetters.length)];
        guessLetter(hintLetter);
        wordGuessState.score -= 5; // Penalty for using hint
        updateWordGuessDisplay();
    }
}
</script>
{% endblock %}
